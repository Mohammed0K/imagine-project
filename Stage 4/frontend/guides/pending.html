<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Account Pending | Imagine</title>
  <link rel="stylesheet" href="pending.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>

<body>
  <!-- âœ… Unified Navbar -->
  <div id="navbar"></div>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script src="../../supabase/supabaseClient.js"></script>
  <script src="../../shared/navbar.js"></script>

  <!-- ðŸ•’ Pending Section -->
  <div class="pending-wrapper">
    <main class="pending-card">
      <div class="icon-circle">
        <i class="fa-regular fa-hourglass-half"></i>
      </div>

      <h2>Your Account is Under Review</h2>
      <p class="subtitle">
        Thank you for registering as a <strong>Guide</strong>!  
        Our team is reviewing your account for authenticity and quality assurance.
      </p>

      <p class="note">
        This step usually takes a short time.  
        You will be notified once your account is approved âœ…
      </p>

      <!-- â³ Ø¹Ø¯Ù‘Ø§Ø¯ -->
      <p id="countdown" style="
        font-size: 1.1rem;
        font-weight: 600;
        color: #556b2f;
        margin-bottom: 15px;
      "></p>

      <div class="actions">
        <button id="logout-btn" class="btn-logout">Logout</button>
        <button id="contact-btn" class="btn-contact">
          <i class="fa-regular fa-envelope"></i> Contact Support
        </button>
      </div>
    </main>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      // âœ… Get User
      const { data: { user }} = await supabaseClient.auth.getUser();
      
      if (!user) {
        startCountdown();
        return;
      }

      // âœ… Check Guide Status
      const { data: guide } = await supabaseClient
        .from("guides")
        .select("status")
        .eq("id", user.id)
        .single();

      // âœ… If approved â†’ Go to dashboard
      if (guide?.status === "approved") {
        window.location.href = "../../dashboard_guides/dashboard_guides.html";
        return;
      }

      // âœ… If still pending â†’ Show countdown only
      startCountdown();

      // Contact
      document.getElementById("contact-btn").onclick = () => {
        window.location.href = "../../contact/contact.html";
      };

      // Logout
      document.getElementById("logout-btn").onclick = async () => {
        await supabaseClient.auth.signOut();
        window.location.href = "../../home/home.html";
      };
    });

    // â³ ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø¹Ø¯Ù‘Ø§Ø¯ + Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ø¹Ø¯ 30 Ø«Ø§Ù†ÙŠØ©
    function startCountdown() {
      let timeLeft = 30;
      const countdownEl = document.getElementById("countdown");

      countdownEl.textContent = `You will be redirected in ${timeLeft} seconds...`;

      const timer = setInterval(() => {
        timeLeft--;
        countdownEl.textContent = `You will be redirected in ${timeLeft} seconds...`;

        if (timeLeft <= 0) {
          clearInterval(timer);
          window.location.href = "../../login_guides/login_guides.html";
        }
      }, 1000);
    }
  </script>

  <!-- âš“ Footer -->
  <footer class="footer">
    <p>Â© 2025 Imagine Project</p>
  </footer>
</body>
</html>
